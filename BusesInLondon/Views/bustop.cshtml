@inherits Nancy.ViewEngines.Razor.NancyRazorViewBase<object>

@{
  Layout = "_Layout.cshtml";
}   

        
<h3>I'm bussing</h3>
<form role="form" method="POST" action="/index">
    <div class="form-group">
        <label class="sr-only" for="bustopcode"></label>
        <input class="form-control" type="text" name="bustopcode" id="bustopcode" data-bind="value: stopCode"
               placeholder="put your bustop code here" />
    </div>
    
    <table class="table table-condensed table-striped">
        <thead>
            <tr>
                <th>No.</th>
                <th>Destination</th>
                <th>Time to wait</th>
                <th>Scheduled time</th>

            </tr>
        </thead>
        <tbody data-bind="foreach: arrivals">
            <tr>
                <td data-bind="text: RouteName"></td>
                <td data-bind="text: Destination"></td>
                <td data-bind="text: EstimatedWait"></td>
                <td data-bind="text: ScheduledTime"></td>
            </tr>
        </tbody>
    </table>

    <button class="btn btn-default" type="submit" data-bind="click: find">Find bus times</button>
</form>

<script type="text/javascript">
    var BusModel = function() {
        var self = this;
        
        self.stopCode = ko.observable('');
        self.arrivals = ko.observableArray();
        self.find = function() {
            $.get('/bustops/' + self.stopCode() + '/', function(result) {
                console.log(result.Arrivals);
                self.arrivals(result.Arrivals);
            });
        };
    };

    $(function () {
        var viewModel = new BusModel();
        ko.applyBindings(viewModel);
    });
    
    
</script>